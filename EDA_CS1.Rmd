---
title: "Case Study 1 DDS 6306"
author: "Cameron Stewart"
date: "2/14/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Read in Data

```{r}
library(naniar)
library(stringr)
library(class)
library(caret)
library(e1071)
library(plyr)
library(dplyr)
library(ggthemes)
library(tidyverse)

#Read in beers.csv and convert variables to the appropriate class. Also change the 'Name' column to be more specific due to conflict in the other dataset

beers = read.csv("~/Documents/SMU_DS/Doing Data Science/DDS_Git/Doing-Data-Science/Unit 8 and 9 Case Study 1/Beers.csv",header = TRUE)

colnames(beers)[1]="Beer_Name"
beers$Beer_ID = as.factor(beers$Beer_ID)
beers$Brewery_id = as.factor(beers$Brewery_id)
beers$Style = as.factor(beers$Style)
summary(beers)
str(beers)

#Read in breweries.csv and convert variables to the appropriate class. Also change the 'Name' column to be more specific due to conflict with the other dataset

breweries = read.csv("~/Documents/SMU_DS/Doing Data Science/DDS_Git/Doing-Data-Science/Unit 8 and 9 Case Study 1/Breweries.csv",header = TRUE)

colnames(breweries)[2] = "Brewery_Name"
breweries$Brew_ID = as.factor(breweries$Brew_ID)
breweries$City = as.factor(breweries$City)
breweries$State = as.factor(breweries$State)
str(breweries)
```

## Find the numer of Breweries located in each state

```{r}
breweries_by_state = data.frame(breweries %>% group_by(State) %>% summarise(Count = n()) %>% arrange(desc(Count)))
breweries_by_state
head(breweries_by_state,25) %>% ggplot(aes(x=reorder(State,-Count),y=Count))+geom_bar(stat = 'identity',color='skyblue',fill='steelblue') + xlab("State") + ylab("Count of Breweries") + ggtitle("Count of Breweries per State","Top 25 States") + theme(axis.text.x=element_text(angle=45, hjust=1))
```

## Merge beer data with the breweries data. Printing the first 6 observations and the last 6 observations to check the merged file.

```{r}
#Performed outter merge

beers_merge=merge(beers,breweries,by.x = "Brewery_id", by.y = "Brew_ID")
str(beers_merge)
head(beers_merge,6)
tail(beers_merge,6)
beers_merge[beers_merge$State==' SD',]
```

## Address the NA values

```{r}
#Summarize NA for each variable in all three dataframes. Then visualize the merged dataframe NAs
miss_var_cumsum(beers)
miss_var_cumsum(breweries)
miss_var_cumsum(beers_merge)
gg_miss_var(beers_merge) + ggtitle("Missing Values per Variable in Merged Dataset")
```

#### The brewries data frame has no NA values but the beers data frame has 1067 NA values. When the two tables are merged together, the 1067 NA values from the beers data frame are transferred to the beers_merge data frame. There are 1005 NA values in IBU and 62 NA values in ABV.

## Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare

```{r}
#Create summarized data frame with ABV and IBU medians
ABV_IBU_by_state = data.frame(beers_merge %>% group_by(State) %>% summarise(median_ABV = median(ABV,na.rm = TRUE), median_IBU = median(IBU,na.rm = TRUE)))

#Re-order the factors for median_ABV so the bar chart can be plotted in descending order
ABV_IBU_by_state$State= fct_reorder(ABV_IBU_by_state$State, desc(ABV_IBU_by_state$median_ABV))

#Arrange the data frame where median_ABV is in descending order so that the data frame can be sliced
ABV_IBU_by_state = ABV_IBU_by_state %>% arrange(desc(median_ABV))

#Due to the plot being too cluttered when plotting all states at once, slice the data frame in half and make two bar charts
head(ABV_IBU_by_state,25) %>% ggplot(aes(x=State,y=median_ABV)) + geom_bar(stat = 'identity',color='skyblue',fill='steelblue') + xlab("State") + ylab("Median ABV") + ggtitle("Median ABV by State","Top 25 States") + theme(axis.text.x=element_text(angle=45, hjust=1)) + scale_y_continuous(breaks = seq(0,0.07,0.01),limits = c(0,0.065))

tail(ABV_IBU_by_state,26) %>% ggplot(aes(x=State,y=median_ABV)) + geom_bar(stat = 'identity',color='skyblue',fill='steelblue') + xlab("State") + ylab("Median ABV") + ggtitle("Median ABV by State","Bottom 26 States") + theme(axis.text.x=element_text(angle=45, hjust=1)) + scale_y_continuous(breaks = seq(0,0.06,0.01),limits = c(0,0.065))

#Repeat steps above to plot median_IBU       
ABV_IBU_by_state$State= fct_reorder(ABV_IBU_by_state$State, desc(ABV_IBU_by_state$median_IBU))

ABV_IBU_by_state = ABV_IBU_by_state %>% arrange(desc(median_IBU))

head(ABV_IBU_by_state,25) %>% ggplot(aes(x=State,y=median_IBU)) + geom_bar(stat = 'identity',color='skyblue',fill='steelblue') + xlab("State") + ylab("Median IBU") + ggtitle("Median IBU by State","Top 25 States") + theme(axis.text.x=element_text(angle=45, hjust=1)) + scale_y_continuous(breaks = seq(0,65,10),limits = c(0,62))

tail(ABV_IBU_by_state,26) %>% ggplot(aes(x=State,y=median_IBU)) + geom_bar(stat = 'identity',color='skyblue',fill='steelblue') + xlab("State") + ylab("Median IBU") + ggtitle("Median IBU by State","Bottom 26 States") + theme(axis.text.x=element_text(angle=45, hjust=1)) + scale_y_continuous(breaks = seq(0,65,10),limits = c(0,62))
```

## Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?

```{r}
#Max ABV beer
beers_merge[which(beers_merge$IBU==max(beers_merge$IBU,na.rm = TRUE)),]

#Max IBU beer
beers_merge[which(beers_merge$ABV==max(beers_merge$ABV,na.rm = TRUE)),]
```


## Comment on the summary statistics and distribution of the ABV variable.

```{r}
summary(beers_merge$ABV)
beers_merge %>% ggplot() + geom_boxplot(aes(x=ABV,y="All Beers")) + coord_flip()
```

##  Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.

```{r}
beers_merge %>% ggplot(aes(x=ABV,y=IBU)) + geom_point() + geom_smooth(method = "lm")
```







